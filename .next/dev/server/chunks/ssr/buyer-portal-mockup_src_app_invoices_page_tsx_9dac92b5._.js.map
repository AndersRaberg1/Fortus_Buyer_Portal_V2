{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/andersraberg/buyer-portal-mockup/src/app/invoices/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useDropzone } from 'react-dropzone';\nimport { createClient } from '@supabase/supabase-js';\nimport Link from 'next/link';\nimport { Trash2, Search, Upload } from 'lucide-react';\n\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n);\n\nexport default function Invoices() {\n  const [invoices, setInvoices] = useState<any[]>([]);\n  const [filteredInvoices, setFilteredInvoices] = useState<any[]>([]);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [latestParsed, setLatestParsed] = useState<any>(null);\n\n  const fetchInvoices = async () => {\n    const { data, error } = await supabase.from('invoices').select('*').order('created_at', { ascending: false });\n    if (error) setError(error.message);\n    else {\n      setInvoices(data || []);\n      setFilteredInvoices(data || []);\n    }\n  };\n\n  useEffect(() => {\n    fetchInvoices();\n  }, []);\n\n  useEffect(() => {\n    const lower = searchTerm.toLowerCase();\n    setFilteredInvoices(invoices.filter(inv => \n      inv.invoice_number?.toLowerCase().includes(lower) ||\n      inv.supplier?.toLowerCase().includes(lower) ||\n      inv.amount?.toLowerCase().includes(lower)\n    ));\n  }, [searchTerm, invoices]);\n\n  const onDrop = async (acceptedFiles: File[]) => {\n    if (!acceptedFiles.length) return;\n\n    setLoading(true);\n    setError(null);\n    setLatestParsed(null);\n\n    const file = acceptedFiles[0];\n    const formData = new FormData();\n    formData.append('file', file);\n\n    try {\n      const res = await fetch('/api/extract-pdf', { method: 'POST', body: formData });\n      const result = await res.json();\n      if (!res.ok) throw new Error(result.error || 'Upload misslyckades');\n\n      setLatestParsed(result.parsed);\n      await fetchInvoices();\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const deleteInvoice = async (inv: any) => {\n    if (!confirm('Radera fakturan permanent?')) return;\n\n    if (inv.pdf_url) {\n      const fileName = inv.pdf_url.split('/').pop();\n      await supabase.storage.from('invoices').remove([fileName]);\n    }\n\n    const { error } = await supabase.from('invoices').delete().eq('id', inv.id);\n    if (error) setError(error.message);\n    else await fetchInvoices();\n  };\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    accept: { 'application/pdf': [], 'image/*': [] },\n    maxFiles: 1,\n  });\n\n  return (\n    <div className=\"max-w-7xl mx-auto\">\n      <h1 className=\"text-5xl font-bold mb-16 text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-blue-800\">\n        Fakturor\n      </h1>\n\n      <section className=\"mb-20\">\n        <h2 className=\"text-3xl font-semibold mb-10\">Ladda upp ny faktura</h2>\n        <div {...getRootProps()} className={`bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900 dark:to-blue-800 rounded-3xl p-24 md:p-32 text-center cursor-pointer transition-all duration-500 hover:scale-105 hover:shadow-2xl ${isDragActive ? 'ring-8 ring-blue-500' : ''}`}>\n          <input {...getInputProps()} />\n          <Upload className=\"w-24 h-24 mx-auto mb-8 text-blue-600\" />\n          <p className=\"text-3xl md:text-4xl font-bold text-blue-800 dark:text-blue-200\">\n            {isDragActive ? 'Släpp filen här' : 'Dra och släpp PDF/bild eller klicka'}\n          </p>\n          {loading && <p className=\"mt-10 text-2xl text-blue-600 animate-pulse\">Bearbetar fakturan...</p>}\n          {error && <p className=\"mt-10 text-2xl text-red-600\">{error}</p>}\n        </div>\n      </section>\n\n      {latestParsed && (\n        <section className=\"mb-20 bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900 dark:to-blue-900 rounded-3xl shadow-2xl p-12\">\n          <h2 className=\"text-3xl font-semibold mb-10\">Nyuppladdad faktura</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-10 text-xl\">\n            <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg\">\n              <p className=\"text-gray-600\">Belopp</p>\n              <p className=\"text-4xl font-bold text-blue-600\">{latestParsed.amount}</p>\n            </div>\n            <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg\">\n              <p className=\"text-gray-600\">Förfallodatum</p>\n              <p className=\"text-3xl font-bold\">{latestParsed.dueDate}</p>\n            </div>\n            <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg\">\n              <p className=\"text-gray-600\">Leverantör</p>\n              <p className=\"text-2xl font-bold\">{latestParsed.supplier}</p>\n            </div>\n            <div className=\"bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg col-span-1 md:col-span-3\">\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                <p><strong>Fakturanummer:</strong> {latestParsed.invoiceNumber}</p>\n                <p><strong>OCR-nummer:</strong> {latestParsed.ocrNumber}</p>\n                <p><strong>Bankgiro:</strong> {latestParsed.bankgiro}</p>\n              </div>\n            </div>\n          </div>\n        </section>\n      )}\n\n      <section>\n        <h2 className=\"text-3xl font-semibold mb-10\">Sparade fakturor</h2>\n\n        <div className=\"relative mb-12\">\n          <Search className=\"absolute left-6 top-5 w-8 h-8 text-gray-500\" />\n          <input\n            type=\"text\"\n            placeholder=\"Sök på fakturanummer, leverantör eller belopp...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"w-full pl-20 pr-8 py-6 text-xl border-2 rounded-3xl dark:bg-gray-800 focus:ring-4 focus:ring-blue-500 focus:border-blue-500 transition\"\n          />\n        </div>\n\n        {filteredInvoices.length === 0 ? (\n          <p className=\"text-center text-2xl text-gray-500 py-32\">Inga fakturor (eller ingen match).</p>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-12\">\n            {filteredInvoices.map((inv) => (\n              <div key={inv.id} className=\"bg-white dark:bg-gray-800 rounded-3xl shadow-2xl p-10 hover:scale-105 hover:shadow-3xl transition-all duration-500 relative\">\n                <button\n                  onClick={() => deleteInvoice(inv)}\n                  className=\"absolute top-6 right-6 text-red-600 hover:text-red-800\"\n                >\n                  <Trash2 className=\"w-10 h-10\" />\n                </button>\n                <div className=\"space-y-8\">\n                  <p className=\"text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-blue-800\">\n                    {inv.amount || 'Ej hittat'}\n                  </p>\n                  <div className=\"space-y-5 text-xl\">\n                    <p><strong>Förfallodatum:</strong> <span className=\"font-bold text-2xl\">{inv.due_date || 'Ej hittat'}</span></p>\n                    <p><strong>Leverantör:</strong> <span className=\"font-bold\">{inv.supplier || 'Ej hittat'}</span></p>\n                    <p><strong>Fakturanummer:</strong> <span className=\"font-bold\">{inv.invoice_number || 'Ej hittat'}</span></p>\n                    <p><strong>OCR-nummer:</strong> <span className=\"font-bold\">{inv.ocr_number || 'Ej hittat'}</span></p>\n                    <p><strong>Bankgiro:</strong> <span className=\"font-bold\">{inv.bankgiro || 'Ej hittat'}</span></p>\n                  </div>\n                </div>\n                <div className=\"mt-10 flex gap-6\">\n                  <a href={inv.pdf_url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"flex-1 text-center bg-gradient-to-r from-blue-600 to-blue-700 text-white py-5 rounded-2xl hover:from-blue-700 hover:to-blue-800 transition shadow-xl text-xl font-semibold\">\n                    Öppna PDF\n                  </a>\n                  <Link href=\"/fortusflex\" className=\"flex-1 text-center bg-gradient-to-r from-green-600 to-green-700 text-white py-5 rounded-2xl hover:from-green-700 hover:to-green-800 transition shadow-xl text-xl font-semibold\">\n                    FortusFlex-kalkyl\n                  </Link>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </section>\n    </div>\n  );\n}"],"names":[],"mappings":"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"}}]
}